<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>handbook</title>
    <link rel="stylesheet" type="text/css" href="../../../../static/css/main.css">
</head>
<body>
<div class="nav">
    <div class="logo">
        
            <img src="../../../../idoc-logo.svg">
        
    </div>
<ul><li><a href="../../../../index.html">Git常用命令</a></li><li><a href="#"><span></span>前端</a><ul><li><a href="#"><span></span>Javascript</a><ul><li><a href="#"><span></span>RN</a><ul><li><a href="../../../../html/前端/Javascript/RN/React-native Android环境搭建.html">React-native Android环境搭建</a></li></ul></li><li><a href="../../../../html/前端/Javascript/思维导图.html">思维导图</a></li><li><a href="../../../../html/前端/Javascript/正则表达式.html">正则表达式</a></li><li><a href="../../../../html/前端/Javascript/轻量高效的开源JavaScript插件和库.html">轻量高效的开源JavaScript插件和库</a></li></ul></li></ul></li><li><a href="#"><span></span>服务端编程</a><ul><li><a href="#"><span></span>数据库</a><ul><li><a href="../../../../html/服务端编程/数据库/Redis.html">Redis</a></li></ul></li><li><a href="#"><span></span>系统服务</a><ul><li><a href="../../../../html/服务端编程/系统服务/docker.html">docker</a></li><li><a href="#"><span></span>shell</a><ul><li><a href="../../../../html/服务端编程/系统服务/shell/shell-regex.html">shell-regex</a></li><li><a href="../../../../html/服务端编程/系统服务/shell/Shell.html">Shell</a></li></ul></li><li><a href="../../../../html/服务端编程/系统服务/Nginx.html">Nginx</a></li></ul></li><li><a href="#"><span></span>Linux</a><ul></ul></li><li><a href="#"><span></span>数据库</a><ul><li><a href="#"><span></span>mysql</a><ul><li><a href="../../../../html/服务端编程/数据库/mysql/21-minutes-MySQL-basic-entry.html">21-minutes-MySQL-basic-entry</a></li><li><a href="../../../../html/服务端编程/数据库/mysql/awesome-mysql.html">awesome-mysql</a></li><li><a href="#"><span></span>chapter1</a><ul><li><a href="../../../../html/服务端编程/数据库/mysql/chapter1/1.1.html">1.1</a></li><li><a href="../../../../html/服务端编程/数据库/mysql/chapter1/1.2.html">1.2</a></li><li><a href="../../../../html/服务端编程/数据库/mysql/chapter1/1.3.html">1.3</a></li><li><a href="../../../../html/服务端编程/数据库/mysql/chapter1/1.4.html">1.4</a></li><li><a href="../../../../html/服务端编程/数据库/mysql/chapter1/1.html">1</a></li></ul></li><li><a href="#"><span></span>chapter17</a><ul><li><a href="../../../../html/服务端编程/数据库/mysql/chapter17/17.1.html">17.1</a></li><li><a href="../../../../html/服务端编程/数据库/mysql/chapter17/17.2.html">17.2</a></li><li><a href="../../../../html/服务端编程/数据库/mysql/chapter17/17.3.html">17.3</a></li></ul></li><li><a href="#"><span></span>chapter2</a><ul><li><a href="../../../../html/服务端编程/数据库/mysql/chapter2/2.1.html">2.1</a></li><li><a href="../../../../html/服务端编程/数据库/mysql/chapter2/2.2.html">2.2</a></li><li><a href="../../../../html/服务端编程/数据库/mysql/chapter2/2.3.html">2.3</a></li><li><a href="../../../../html/服务端编程/数据库/mysql/chapter2/2.4.html">2.4</a></li><li><a href="../../../../html/服务端编程/数据库/mysql/chapter2/2.5.html">2.5</a></li></ul></li><li><a href="#"><span></span>chapter3</a><ul><li><a href="../../../../html/服务端编程/数据库/mysql/chapter3/3.1.html">3.1</a></li><li><a href="../../../../html/服务端编程/数据库/mysql/chapter3/3.2.html">3.2</a></li><li><a href="../../../../html/服务端编程/数据库/mysql/chapter3/3.3.html">3.3</a></li><li><a href="../../../../html/服务端编程/数据库/mysql/chapter3/3.4.html">3.4</a></li><li><a href="../../../../html/服务端编程/数据库/mysql/chapter3/3.5.html">3.5</a></li><li><a href="../../../../html/服务端编程/数据库/mysql/chapter3/3.html">3</a></li></ul></li><li><a href="../../../../html/服务端编程/数据库/mysql/README.html">README</a></li></ul></li><li><a href="../../../../html/服务端编程/数据库/Redis.html">Redis</a></li></ul></li></ul></li><li><a href="#"><span></span>工具快捷键</a><ul><li><a href="../../../../html/工具快捷键/Git常用命令.html">Git常用命令</a></li><li><a href="../../../../html/工具快捷键/vim.html">vim</a></li></ul></li><li><a href="#"><span></span>其他</a><ul><li><a href="../../../../html/其他/HTTP状态码.html">HTTP状态码</a></li><li><a href="../../../../html/其他/通过代理工具提高Github Clone速度.html">通过代理工具提高Github Clone速度</a></li></ul></li></ul></div>


<div class="forkgithub"><a target="_blank" href="https://github.com/poetries/handbook.git"></a></div>

<div class="warpper">

    <div class="page-toc">
        <ul><li><a href="#t0官方安装">官方安装</a></li><li><a href="#t1第三方镜像安装">第三方镜像安装</a><ul><li><a href="#t2编辑源">编辑源</a></li><li><a href="#t3更新本地YUM缓存">更新本地YUM缓存</a></li><li><a href="#t4安装社区版">安装社区版</a></li><li><a href="#t5更改配置">更改配置</a></li><li><a href="#t6配置并启动GitLab">配置并启动GitLab</a></li><li><a href="#t7登录GitLab">登录GitLab</a></li></ul></li><li><a href="#t8卸载">卸载</a></li><li><a href="#t9运维">运维</a><ul><li><a href="#t10服务管理">服务管理</a></li><li><a href="#t11日志查看">日志查看</a></li><li><a href="#t12重置管理员密码">重置管理员密码</a></li></ul></li><li><a href="#t13备份恢复">备份恢复</a><ul><li><a href="#t14修改备份文件默认目录">修改备份文件默认目录</a></li><li><a href="#t15创建备份">创建备份</a></li><li><a href="#t16开始备份">开始备份</a></li><li><a href="#t17自动备份">自动备份</a></li><li><a href="#t18备份保留七天">备份保留七天</a></li><li><a href="#t19开始恢复">开始恢复</a></li></ul></li><li><a href="#t20一些常规目录">一些常规目录</a></li><li><a href="#t21使用HTTPS">使用HTTPS</a></li><li><a href="#t22暴力升级">暴力升级</a></li><li><a href="#t23错误处理">错误处理</a><ul><li><a href="#t24解决80端口被占用">解决80端口被占用</a></li><li><a href="#t25头像无法正常显示">头像无法正常显示</a></li><li><a href="#t26internal API unreachable">internal API unreachable</a></li><li><a href="#t27proxy_temp 目录没有权限">proxy_temp 目录没有权限</a></li><li><a href="#t28其它错误">其它错误</a></li></ul></li><li><a href="#t29参考资料">参考资料</a></li></ul>
    </div>
    
    <div class="content markdown-body">
        <h2 id="t0&#x5B98;&#x65B9;&#x5B89;&#x88C5;">&#x5B98;&#x65B9;&#x5B89;&#x88C5; <a href="#t0&#x5B98;&#x65B9;&#x5B89;&#x88C5;"> # </a></h2>
<p>&#x4E0B;&#x9762;&#x662F;&#x5B98;&#x7F51;&#x590D;&#x5236;&#x8FC7;&#x6765;&#x7684;&#x5B98;&#x65B9;&#x5B89;&#x88C5;&#x65B9;&#x6CD5;&#xFF0C;&#x6700;&#x7B80;&#x5355;&#x7684;&#x5B89;&#x88C5;&#xFF0C;&#x5728;&#x6211;&#x5927;&#x5929;&#x671D;&#xFF0C;&#x53EA;&#x80FD;&#x671B;&#x5929;&#x5174;&#x53F9;&#xFF0C;&#x4F60;&#x53EF;&#x7FFB;&#x5899;&#x5B89;&#x88C5;&#x6216;&#x8005;&#x7565;&#x8FC7;&#x8FD9;&#x91CC;&#xFF0C;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x3002;</p>
<ol>
<li>&#x5B89;&#x88C5;&#x5E76;&#x914D;&#x7F6E;&#x5FC5;&#x8981;&#x7684;&#x4F9D;&#x8D56;&#x9879;</li>
</ol>
<p>If you install Postfix to send email please select &apos;Internet Site&apos; during setup. Instead of using Postfix you can also use Sendmail or configure a custom SMTP server and configure it as an SMTP server.</p>
<p>On Centos 6 and 7, the commands below will also open HTTP and SSH access in the system firewall.</p>
<pre><code>sudo yum install curl openssh-server openssh-clients postfix cronie
sudo service postfix start
sudo chkconfig postfix on
sudo lokkit -s http -s ssh
</code></pre><ol>
<li>&#x6DFB;&#x52A0;gitlab&#x670D;&#x52A1;&#x5668;&#x5305;&#x548C;&#x5B89;&#x88C5;&#x5305;</li>
</ol>
<pre><code>curl -sS https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | sudo bash
sudo yum install gitlab-ce
</code></pre><p>If you are not comfortable installing the repository through a piped script, you can find the entire script here and select and download the package manually and install using
<a href="https://packages.gitlab.com/gitlab/gitlab-ce">gitlab/gitlab-ce</a></p>
<pre><code class="lang-bash">curl -LJO https://packages.gitlab.com/gitlab/gitlab-ce/packages/el/6/gitlab-ce-XXX.rpm/download
curl -LJO https://packages.gitlab.com/gitlab/gitlab-ce/packages/el/7/gitlab-ce-10.2.2-ce.0.el7.x86_64.rpm/download
rpm -i gitlab-ce-XXX.rpm
</code></pre>
<ol>
<li>&#x914D;&#x7F6E;&#x5E76;&#x542F;&#x52A8;GitLab</li>
</ol>
<pre><code>sudo gitlab-ctl reconfigure
</code></pre><ol>
<li>&#x6D4F;&#x89C8;&#x5668;&#x6253;&#x5F00;&#x5E76;&#x767B;&#x5F55;</li>
</ol>
<p>On your first visit, you&apos;ll be redirected to a password reset screen to provide the password for the initial administrator account. Enter your desired password and you&apos;ll be redirected back to the login screen.</p>
<p>The default account&apos;s username is root. Provide the password you created earlier and login. After login you can change the username if you wish.</p>
<h2 id="t1&#x7B2C;&#x4E09;&#x65B9;&#x955C;&#x50CF;&#x5B89;&#x88C5;">&#x7B2C;&#x4E09;&#x65B9;&#x955C;&#x50CF;&#x5B89;&#x88C5; <a href="#t1&#x7B2C;&#x4E09;&#x65B9;&#x955C;&#x50CF;&#x5B89;&#x88C5;"> # </a></h2>
<ul>
<li><a href="https://mirror.tuna.tsinghua.edu.cn/help/gitlab-ce/">Gitlab Community Edition &#x955C;&#x50CF;&#x4F7F;&#x7528;&#x5E2E;&#x52A9;</a></li>
<li><a href="https://github.com/hehongwei44/my-blog/issues/19">&#x5728;&#x963F;&#x91CC;&#x4E91;&#x4E0A;&#x901A;&#x8FC7;Omnibus&#x4E00;&#x952E;&#x5B89;&#x88C5;&#x5305;&#x5B89;&#x88C5;Gitlab</a></li>
</ul>
<h3 id="t2&#x7F16;&#x8F91;&#x6E90;">&#x7F16;&#x8F91;&#x6E90; <a href="#t2&#x7F16;&#x8F91;&#x6E90;"> # </a></h3>
<p>&#x65B0;&#x5EFA; /etc/yum.repos.d/gitlab-ce.repo&#xFF0C;&#x5185;&#x5BB9;&#x4E3A;</p>
<p><a href="https://mirror.tuna.tsinghua.edu.cn/help/gitlab-ce/">&#x4F7F;&#x7528;&#x6E05;&#x534E;&#x5927;&#x5B66; TUNA &#x955C;&#x50CF;&#x6E90;</a> &#x6253;&#x5F00;&#x7F51;&#x5740;&#x5C06;&#x5185;&#x5BB9;&#x590D;&#x5236;&#x5230;<code>gitlab-ce.repo</code>&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x7F16;&#x8F91;&#x8DEF;&#x5F84;<code>vim /etc/yum.repos.d/gitlab-ce.repo</code></p>
<pre><code class="lang-bash">[gitlab-ce]
name=gitlab-ce
baseurl=http://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el6
repo_gpgcheck=0
gpgcheck=0
enabled=1
gpgkey=https://packages.gitlab.com/gpg.key
</code></pre>
<h3 id="t3&#x66F4;&#x65B0;&#x672C;&#x5730;YUM&#x7F13;&#x5B58;">&#x66F4;&#x65B0;&#x672C;&#x5730;YUM&#x7F13;&#x5B58; <a href="#t3&#x66F4;&#x65B0;&#x672C;&#x5730;YUM&#x7F13;&#x5B58;"> # </a></h3>
<pre><code class="lang-bash">sudo yum makecache
</code></pre>
<h3 id="t4&#x5B89;&#x88C5;&#x793E;&#x533A;&#x7248;">&#x5B89;&#x88C5;&#x793E;&#x533A;&#x7248; <a href="#t4&#x5B89;&#x88C5;&#x793E;&#x533A;&#x7248;"> # </a></h3>
<pre><code class="lang-bash">sudo yum install gitlab-ce <span class="hljs-comment">#(&#x81EA;&#x52A8;&#x5B89;&#x88C5;&#x6700;&#x65B0;&#x7248;)</span>
sudo yum install gitlab-ce-8.15.2-ce.0.el6 <span class="hljs-comment">#(&#x5B89;&#x88C5;&#x6307;&#x5B9A;&#x7248;&#x672C;)</span>
</code></pre>
<h3 id="t5&#x66F4;&#x6539;&#x914D;&#x7F6E;">&#x66F4;&#x6539;&#x914D;&#x7F6E; <a href="#t5&#x66F4;&#x6539;&#x914D;&#x7F6E;"> # </a></h3>
<pre><code class="lang-bash">vim /etc/gitlab/gitlab.rb
<span class="hljs-comment"># &#x627E;&#x5230; external_url &apos;http://000.00.00.00:8081&apos;</span>
<span class="hljs-comment"># &#x4FEE;&#x6539;&#x6210;&#x4F60;&#x7684;&#x5730;&#x5740;</span>
</code></pre>
<h3 id="t6&#x914D;&#x7F6E;&#x5E76;&#x542F;&#x52A8;GitLab">&#x914D;&#x7F6E;&#x5E76;&#x542F;&#x52A8;GitLab <a href="#t6&#x914D;&#x7F6E;&#x5E76;&#x542F;&#x52A8;GitLab"> # </a></h3>
<pre><code class="lang-bash"><span class="hljs-comment"># &#x6253;&#x5F00;`/etc/gitlab/gitlab.rb`,</span>
<span class="hljs-comment"># &#x5C06;`external_url = &apos;http://git.example.com&apos;`&#x4FEE;&#x6539;&#x4E3A;&#x81EA;&#x5DF1;&#x7684;IP&#x5730;&#x5740;&#xFF1A;`http://xxx.xx.xxx.xx`&#xFF0C;</span>
<span class="hljs-comment"># &#x7136;&#x540E;&#x6267;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x5BF9;GitLab&#x8FDB;&#x884C;&#x7F16;&#x8BD1;&#x3002;</span>
sudo gitlab-ctl reconfigure
<span class="hljs-comment"># &#x6E05;&#x9664;&#x7F13;&#x5B58;</span>
sudo gitlab-rake cache:clear RAILS_ENV=production
</code></pre>
<h3 id="t7&#x767B;&#x5F55;GitLab">&#x767B;&#x5F55;GitLab <a href="#t7&#x767B;&#x5F55;GitLab"> # </a></h3>
<pre><code>Username: root 
Password: 5iveL!fe
</code></pre><h2 id="t8&#x5378;&#x8F7D;">&#x5378;&#x8F7D; <a href="#t8&#x5378;&#x8F7D;"> # </a></h2>
<pre><code class="lang-bash">sudo gitlab-ctl uninstall
</code></pre>
<h2 id="t9&#x8FD0;&#x7EF4;">&#x8FD0;&#x7EF4; <a href="#t9&#x8FD0;&#x7EF4;"> # </a></h2>
<pre><code class="lang-bash"><span class="hljs-comment"># &#x4FEE;&#x6539;&#x9ED8;&#x8BA4;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</span>
sudo vim /etc/gitlab/gitlab.rb

<span class="hljs-comment"># &#x67E5;&#x770B;&#x7248;&#x672C;</span>
sudo cat /opt/gitlab/embedded/service/gitlab-rails/VERSION
<span class="hljs-comment"># echo &quot;vm.overcommit_memory=1&quot; &gt;&gt; /etc/sysctl.conf</span>
<span class="hljs-comment"># sysctl -p</span>
<span class="hljs-comment"># echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span>

<span class="hljs-comment"># &#x68C0;&#x67E5;gitlab</span>
gitlab-rake gitlab:check SANITIZE=<span class="hljs-literal">true</span> --trace
gitlab-rake gitlab:check
gitlab-rake gitlab:check SANITIZE=<span class="hljs-literal">true</span>
<span class="hljs-comment"># &#x67E5;&#x770B;&#x65E5;&#x5FD7;</span>
gitlab-ctl tail
<span class="hljs-comment"># &#x6570;&#x636E;&#x5E93;&#x5173;&#x7CFB;&#x5347;&#x7EA7;</span>
gitlab-rake db:migrate
<span class="hljs-comment"># &#x6E05;&#x7406;&#x7F13;&#x5B58;</span>
gitlab-rake cache:clear

<span class="hljs-comment"># &#x66F4;&#x65B0;gitlab&#x5305;</span>
yum update gitlab-ce

<span class="hljs-comment"># &#x5347;&#x7EA7;gitlab</span>
yum install gitlab-ce

<span class="hljs-comment"># &#x5347;&#x7EA7;&#x6570;&#x636E;&#x547D;&#x4EE4;</span>
gitlab-ctl pg-upgrade
</code></pre>
<h3 id="t10&#x670D;&#x52A1;&#x7BA1;&#x7406;">&#x670D;&#x52A1;&#x7BA1;&#x7406; <a href="#t10&#x670D;&#x52A1;&#x7BA1;&#x7406;"> # </a></h3>
<pre><code class="lang-bash">gitlab-ctl start <span class="hljs-comment"># &#x542F;&#x52A8;&#x6240;&#x6709; gitlab &#x7EC4;&#x4EF6;&#xFF1A;</span>
gitlab-ctl stop  <span class="hljs-comment"># &#x505C;&#x6B62;&#x6240;&#x6709; gitlab &#x7EC4;&#x4EF6;&#xFF1A;</span>
gitlab-ctl stop postgresql <span class="hljs-comment"># &#x505C;&#x6B62;&#x6240;&#x6709; gitlab postgresql &#x7EC4;&#x4EF6;&#xFF1A;</span>
<span class="hljs-comment"># &#x505C;&#x6B62;&#x76F8;&#x5173;&#x6570;&#x636E;&#x8FDE;&#x63A5;&#x670D;&#x52A1;</span>
gitlab-ctl stop unicorn
gitlab-ctl stop sidekiq
gitlab-ctl restart <span class="hljs-comment"># &#x91CD;&#x542F;&#x6240;&#x6709; gitlab &#x7EC4;&#x4EF6;&#xFF1A;</span>
gitlab-ctl restart gitlab-workhorse <span class="hljs-comment"># &#x91CD;&#x542F;&#x6240;&#x6709; gitlab gitlab-workhorse &#x7EC4;&#x4EF6;&#xFF1A;</span>
gitlab-ctl status <span class="hljs-comment"># &#x67E5;&#x770B;&#x670D;&#x52A1;&#x72B6;&#x6001;</span>
gitlab-ctl reconfigure <span class="hljs-comment"># &#x751F;&#x6210;&#x914D;&#x7F6E;&#x542F;&#x52A8;&#x670D;&#x52A1;</span>
</code></pre>
<h3 id="t11&#x65E5;&#x5FD7;&#x67E5;&#x770B;">&#x65E5;&#x5FD7;&#x67E5;&#x770B; <a href="#t11&#x65E5;&#x5FD7;&#x67E5;&#x770B;"> # </a></h3>
<pre><code class="lang-bash">sudo gitlab-ctl tail <span class="hljs-comment"># &#x67E5;&#x770B;&#x65E5;&#x5FD7;</span>
sudo gitlab-ctl tail redis <span class="hljs-comment"># &#x68C0;&#x67E5;redis&#x7684;&#x65E5;&#x5FD7;</span>
sudo gitlab-ctl tail postgresql       <span class="hljs-comment"># &#x68C0;&#x67E5;postgresql&#x7684;&#x65E5;&#x5FD7;</span>
sudo gitlab-ctl tail gitlab-workhorse <span class="hljs-comment"># &#x68C0;&#x67E5;gitlab-workhorse&#x7684;&#x65E5;&#x5FD7;</span>
sudo gitlab-ctl tail logrotate <span class="hljs-comment"># &#x68C0;&#x67E5;logrotate&#x7684;&#x65E5;&#x5FD7;</span>
sudo gitlab-ctl tail nginx    <span class="hljs-comment"># &#x68C0;&#x67E5;nginx&#x7684;&#x65E5;&#x5FD7;</span>
sudo gitlab-ctl tail sidekiq  <span class="hljs-comment"># &#x68C0;&#x67E5;sidekiq&#x7684;&#x65E5;&#x5FD7;</span>
sudo gitlab-ctl tail unicorn  <span class="hljs-comment"># &#x68C0;&#x67E5;unicorn&#x7684;&#x65E5;&#x5FD7;</span>
</code></pre>
<h3 id="t12&#x91CD;&#x7F6E;&#x7BA1;&#x7406;&#x5458;&#x5BC6;&#x7801;">&#x91CD;&#x7F6E;&#x7BA1;&#x7406;&#x5458;&#x5BC6;&#x7801; <a href="#t12&#x91CD;&#x7F6E;&#x7BA1;&#x7406;&#x5458;&#x5BC6;&#x7801;"> # </a></h3>
<p>Gitlab&#x7BA1;&#x7406;&#x5458;&#x5BC6;&#x7801;&#x5FD8;&#x8BB0;&#xFF0C;&#x600E;&#x4E48;&#x91CD;&#x7F6E;&#x5BC6;&#x7801;&#xFF0C;Gitlab &#x4FEE;&#x6539;root&#x7528;&#x6237;&#x5BC6;&#x7801;&#xFF0C;<a href="http://docs.gitlab.com/ce/security/reset_root_password.html">How to reset your root password</a>&#x3002;</p>
<p>&#x4F7F;&#x7528;rails&#x5DE5;&#x5177;&#x6253;&#x5F00;&#x7EC8;&#x7AEF;</p>
<pre><code class="lang-bash">sudo gitlab-rails console production
</code></pre>
<p>&#x67E5;&#x8BE2;&#x7528;&#x6237;&#x7684;email&#xFF0C;&#x7528;&#x6237;&#x540D;&#xFF0C;&#x5BC6;&#x7801;&#x7B49;&#x4FE1;&#x606F;&#xFF0C;id:1 &#x8868;&#x793A;root&#x8D26;&#x53F7;</p>
<pre><code class="lang-bash">user = User.where(id: 1).first
</code></pre>
<p>&#x91CD;&#x65B0;&#x8BBE;&#x7F6E;&#x5BC6;&#x7801;</p>
<pre><code class="lang-bash">user.password = <span class="hljs-string">&apos;&#x65B0;&#x5BC6;&#x7801;&apos;</span>
user.password_confirmation = <span class="hljs-string">&apos;&#x65B0;&#x5BC6;&#x7801;&apos;</span>
</code></pre>
<p>&#x4FDD;&#x5B58;&#x5BC6;&#x7801;</p>
<pre><code class="lang-bash">user.save!
</code></pre>
<p>&#x5B8C;&#x6574;&#x7684;&#x64CD;&#x4F5C;ruby&#x811A;&#x672C;</p>
<pre><code class="lang-bash">user = User.where(id: 1).first
user.password = <span class="hljs-string">&apos;&#x65B0;&#x5BC6;&#x7801;&apos;</span>
user.password_confirmation = <span class="hljs-string">&apos;&#x65B0;&#x5BC6;&#x7801;&apos;</span>
user.save!
</code></pre>
<h2 id="t13&#x5907;&#x4EFD;&#x6062;&#x590D;">&#x5907;&#x4EFD;&#x6062;&#x590D; <a href="#t13&#x5907;&#x4EFD;&#x6062;&#x590D;"> # </a></h2>
<p>&#x4F7F;&#x7528;Gitlab&#x4E00;&#x952E;&#x5B89;&#x88C5;&#x5305;&#x5B89;&#x88C5;Gitlab&#x975E;&#x5E38;&#x7B80;&#x5355;, &#x540C;&#x6837;&#x7684;&#x5907;&#x4EFD;&#x6062;&#x590D;&#x4E0E;&#x8FC1;&#x79FB;&#x4E5F;&#x975E;&#x5E38;&#x7B80;&#x5355;,&#x7528;&#x4E00;&#x6761;&#x547D;&#x4EE4;&#x5373;&#x53EF;&#x521B;&#x5EFA;&#x5B8C;&#x6574;&#x7684;Gitlab&#x5907;&#x4EFD;:</p>
<h3 id="t14&#x4FEE;&#x6539;&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x9ED8;&#x8BA4;&#x76EE;&#x5F55;">&#x4FEE;&#x6539;&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x9ED8;&#x8BA4;&#x76EE;&#x5F55; <a href="#t14&#x4FEE;&#x6539;&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x9ED8;&#x8BA4;&#x76EE;&#x5F55;"> # </a></h3>
<p>&#x4FEE;&#x6539;<code>/etc/gitlab/gitlab.rb</code>&#x6765;&#x4FEE;&#x6539;&#x9ED8;&#x8BA4;&#x5B58;&#x653E;&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x7684;&#x76EE;&#x5F55;:</p>
<pre><code class="lang-bash">gitlab_rails[<span class="hljs-string">&apos;backup_path&apos;</span>] = <span class="hljs-string">&apos;/mnt/backups&apos;</span>
</code></pre>
<h3 id="t15&#x521B;&#x5EFA;&#x5907;&#x4EFD;">&#x521B;&#x5EFA;&#x5907;&#x4EFD; <a href="#t15&#x521B;&#x5EFA;&#x5907;&#x4EFD;"> # </a></h3>
<pre><code class="lang-bash">gitlab-rake gitlab:backup:create
</code></pre>
<p>&#x4EE5;&#x4E0A;&#x547D;&#x4EE4;&#x5C06;&#x5728;/var/opt/gitlab/backups&#x76EE;&#x5F55;&#x4E0B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x540D;&#x79F0;&#x7C7B;&#x4F3C;&#x4E3A;xxxxxxxx_gitlab_backup.tar&#x7684;&#x538B;&#x7F29;&#x5305;, &#x8FD9;&#x4E2A;&#x538B;&#x7F29;&#x5305;&#x5C31;&#x662F;Gitlab&#x6574;&#x4E2A;&#x7684;&#x5B8C;&#x6574;&#x90E8;&#x5206;, &#x5176;&#x4E2D;&#x5F00;&#x5934;&#x7684;xxxxxx&#x662F;&#x5907;&#x4EFD;&#x521B;&#x5EFA;&#x7684;&#x65F6;&#x95F4;&#x6233;&#x3002;</p>
<p>&#x4FEE;&#x6539;&#x540E;&#x4F7F;&#x7528;gitlab-ctl reconfigure&#x547D;&#x4EE4;&#x91CD;&#x8F7D;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;</p>
<h3 id="t16&#x5F00;&#x59CB;&#x5907;&#x4EFD;">&#x5F00;&#x59CB;&#x5907;&#x4EFD; <a href="#t16&#x5F00;&#x59CB;&#x5907;&#x4EFD;"> # </a></h3>
<p>&#x8FD9;&#x91CC;&#x653E;&#x4F60;&#x7684;&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x548C;&#x4ED3;&#x5E93;&#x6E90;&#x6587;&#x4EF6;&#x3002;</p>
<pre><code class="lang-bash">/var/opt/gitlab/backups                   <span class="hljs-comment"># &#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x6587;&#x4EF6;&#x5939;</span>
/var/opt/gitlab/git-data/repositories     <span class="hljs-comment"># git&#x4ED3;&#x5E93;&#x6E90;&#x6587;&#x4EF6;</span>
</code></pre>
<h3 id="t17&#x81EA;&#x52A8;&#x5907;&#x4EFD;">&#x81EA;&#x52A8;&#x5907;&#x4EFD; <a href="#t17&#x81EA;&#x52A8;&#x5907;&#x4EFD;"> # </a></h3>
<p>&#x901A;&#x8FC7;crontab&#x4F7F;&#x7528;&#x5907;&#x4EFD;&#x547D;&#x4EE4;&#x5B9E;&#x73B0;&#x81EA;&#x52A8;&#x5907;&#x4EFD;</p>
<pre><code class="lang-bash">crontab -e
<span class="hljs-comment"># &#x6BCF;&#x5929;2&#x70B9;&#x5907;&#x4EFD;gitlab&#x6570;&#x636E;</span>
0 2 * * * /usr/bin/gitlab-rake gitlab:backup:create
0 2 * * * /opt/gitlab/bin/gitlab-rake gitlab:backup:create
</code></pre>
<p>&#x4E0A;&#x9762;&#x4E24;&#x884C;&#x4FDD;&#x5B58;&#x4E4B;&#x540E;&#xFF0C;&#x91CD;&#x65B0;&#x8F7D;&#x5165;&#x914D;&#x7F6E;</p>
<pre><code class="lang-bash">service crond reload
<span class="hljs-comment"># or</span>
systemctl reload crond.service
</code></pre>
<h3 id="t18&#x5907;&#x4EFD;&#x4FDD;&#x7559;&#x4E03;&#x5929;">&#x5907;&#x4EFD;&#x4FDD;&#x7559;&#x4E03;&#x5929; <a href="#t18&#x5907;&#x4EFD;&#x4FDD;&#x7559;&#x4E03;&#x5929;"> # </a></h3>
<p>&#x8BBE;&#x7F6E;&#x53EA;&#x4FDD;&#x5B58;&#x6700;&#x8FD1;7&#x5929;&#x7684;&#x5907;&#x4EFD;&#xFF0C;&#x7F16;&#x8F91; /etc/gitlab/gitlab.rb &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x627E;&#x5230;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#xFF0C;&#x5220;&#x9664;&#x6CE8;&#x91CA; <code>#</code> &#x4FDD;&#x5B58;</p>
<pre><code class="lang-bash"><span class="hljs-comment"># /etc/gitlab/gitlab.rb &#x914D;&#x7F6E;&#x6587;&#x4EF6; &#x4FEE;&#x6539;&#x4E0B;&#x9762;&#x8FD9;&#x4E00;&#x884C;</span>
gitlab_rails[<span class="hljs-string">&apos;backup_keep_time&apos;</span>] = 604800
</code></pre>
<p>&#x91CD;&#x65B0;&#x52A0;&#x8F7D;gitlab&#x914D;&#x7F6E;&#x6587;&#x4EF6;</p>
<pre><code class="lang-bash">sudo gitlab-ctl reconfigure
</code></pre>
<h3 id="t19&#x5F00;&#x59CB;&#x6062;&#x590D;">&#x5F00;&#x59CB;&#x6062;&#x590D; <a href="#t19&#x5F00;&#x59CB;&#x6062;&#x590D;"> # </a></h3>
<p>&#x8FC1;&#x79FB;&#x5982;&#x540C;&#x5907;&#x4EFD;&#x4E0E;&#x6062;&#x590D;&#x7684;&#x6B65;&#x9AA4;&#x4E00;&#x6837;, &#x53EA;&#x9700;&#x8981;&#x5C06;&#x8001;&#x670D;&#x52A1;&#x5668;/var/opt/gitlab/backups&#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x62F7;&#x8D1D;&#x5230;&#x65B0;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;/var/opt/gitlab/backups&#x5373;&#x53EF;(&#x5982;&#x679C;&#x4F60;&#x6CA1;&#x4FEE;&#x6539;&#x8FC7;&#x9ED8;&#x8BA4;&#x5907;&#x4EFD;&#x76EE;&#x5F55;&#x7684;&#x8BDD;)&#x3002; &#x7136;&#x540E;&#x6267;&#x884C;&#x6062;&#x590D;&#x547D;&#x4EE4;&#x3002;
&#x5982;&#x679C;&#x4FEE;&#x6539;&#x4E86;&#xFF0C;&#x9996;&#x5148;&#x8FDB;&#x5165;&#x5907;&#x4EFD; gitlab &#x7684;&#x76EE;&#x5F55;&#xFF0C;&#x8FD9;&#x4E2A;&#x76EE;&#x5F55;&#x662F;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x7684; <code>gitlab_rails[&apos;backup_path&apos;]</code> &#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A; <code>/var/opt/gitlab/backups</code> &#x3002;</p>
<p>&#x7136;&#x540E;&#x505C;&#x6B62; unicorn &#x548C; sidekiq &#xFF0C;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x5E93;&#x6CA1;&#x6709;&#x65B0;&#x7684;&#x8FDE;&#x63A5;&#xFF0C;&#x4E0D;&#x4F1A;&#x6709;&#x5199;&#x6570;&#x636E;&#x60C5;&#x51B5;&#x3002;</p>
<pre><code class="lang-bash"><span class="hljs-comment"># &#x505C;&#x6B62;&#x76F8;&#x5173;&#x6570;&#x636E;&#x8FDE;&#x63A5;&#x670D;&#x52A1;</span>
gitlab-ctl stop unicorn
<span class="hljs-comment"># ok: down: unicorn: 0s, normally up</span>
gitlab-ctl stop sidekiq
<span class="hljs-comment"># ok: down: sidekiq: 0s, normally up</span>

<span class="hljs-comment"># &#x4ECE;xxxxx&#x7F16;&#x53F7;&#x5907;&#x4EFD;&#x4E2D;&#x6062;&#x590D;</span>
<span class="hljs-comment"># &#x7136;&#x540E;&#x6062;&#x590D;&#x6570;&#x636E;&#xFF0C;1406691018&#x4E3A;&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x7684;&#x65F6;&#x95F4;&#x6233;</span>
gitlab-rake gitlab:backup:restore BACKUP=1406691018

<span class="hljs-comment"># &#x65B0;&#x7248;&#x672C; 1483533591_2017_01_04_gitlab_backup.tar</span>
gitlab-rake gitlab:backup:restore BACKUP=1483533591_2017_01_04_gitlab_backup.tar

<span class="hljs-comment"># &#x542F;&#x52A8;Gitlab</span>
sudo gitlab-ctl start
</code></pre>
<p>&#x5224;&#x65AD;&#x662F;&#x6267;&#x884C;&#x5B9E;&#x9645;&#x64CD;&#x4F5C;&#x7684;gitlab&#x76F8;&#x5173;&#x7528;&#x6237;&#xFF1A;git&#xFF0C;&#x6CA1;&#x6709;&#x5F97;&#x5230;&#x8DB3;&#x591F;&#x7684;&#x6743;&#x9650;&#x3002;&#x4F9D;&#x6B21;&#x6267;&#x884C;&#x547D;&#x4EE4;&#xFF1A;</p>
<pre><code class="lang-bash"><span class="hljs-comment"># &#x6062;&#x590D;&#x8FC7;&#x7A0B;&#x4E2D;&#x6CA1;&#x6709;&#x6743;&#x9650;</span>
mkdir /var/opt/gitlab/backups
chown git /var/opt/gitlab/backups
chmod 700 /var/opt/gitlab/backups

<span class="hljs-comment"># &#x6062;&#x590D;&#x6210;&#x529F;&#x9875;&#x9762;&#x62A5;&#x6CA1;&#x6709;&#x6743;&#x9650;&#x7684;&#x9519;&#x8BEF;</span>
sudo chown -R git:git /var/opt/gitlab/git-data/repositories
sudo chmod -R ug+rwX,o-rwx /var/opt/gitlab/git-data/repositories
sudo chmod -R ug<span class="hljs-_">-s</span> /var/opt/gitlab/git-data/repositories
sudo find /var/opt/gitlab/git-data/repositories -<span class="hljs-built_in">type</span> d -print0 | sudo xargs -0 chmod g+s
</code></pre>
<p>&#x5982;&#x679C;&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x62A5;&#x6CA1;&#x6709;&#x6743;&#x9650;&#xFF0C;&#x901A;&#x8FC7;<code>ls -al</code>&#x67E5;&#x770B;&#x6743;&#x9650;&#x662F;&#x4E0D;&#x662F;<code>git</code>&#xFF0C;&#x800C;&#x4E0D;&#x662F;<code>root</code>&#xFF0C;&#x901A;&#x8FC7;&#x4E0B;&#x9762;&#x65B9;&#x5F0F;&#x7ED9;<code>git</code>&#x7528;&#x6237;&#x6743;&#x9650;</p>
<pre><code class="lang-bash">sudo chown -R git:git 1483533591_2017_01_04_gitlab_backup.tar
</code></pre>
<h2 id="t20&#x4E00;&#x4E9B;&#x5E38;&#x89C4;&#x76EE;&#x5F55;">&#x4E00;&#x4E9B;&#x5E38;&#x89C4;&#x76EE;&#x5F55; <a href="#t20&#x4E00;&#x4E9B;&#x5E38;&#x89C4;&#x76EE;&#x5F55;"> # </a></h2>
<pre><code class="lang-bash"><span class="hljs-comment"># &#x914D;&#x7F6E;&#x76EE;&#x5F55;</span>
/etc/gitlab/gitlab.rb
<span class="hljs-comment"># &#x751F;&#x6210;&#x597D;&#x7684;nginx&#x914D;&#x7F6E;</span>
/var/opt/gitlab/nginx/conf/gitlab-http.conf
<span class="hljs-comment"># &#x5907;&#x4EFD;&#x76EE;&#x5F55;</span>
/var/opt/gitlab/backups
</code></pre>
<h2 id="t21&#x4F7F;&#x7528;HTTPS">&#x4F7F;&#x7528;HTTPS <a href="#t21&#x4F7F;&#x7528;HTTPS"> # </a></h2>
<p>&#x76F4;&#x63A5;&#x5C06;nginx&#x914D;&#x7F6E;&#x590D;&#x5236;&#x5230;&#x4F60;&#x81EA;&#x5DF1;&#x7684;nginx&#x914D;&#x7F6E;&#x4E2D;&#xFF0C;&#x505C;&#x6389;gitlab&#x7684;nginx</p>
<pre><code class="lang-bash">cp /var/opt/gitlab/nginx/conf/gitlab-http.conf /usr/<span class="hljs-built_in">local</span>/nginx/conf/vhost/
</code></pre>
<p>&#x5C06;&#x4F60;&#x7684;SSL&#x8BC1;&#x4E66;&#x914D;&#x7F6E;&#x590D;&#x5236;&#x8FDB;&#x53BB;</p>
<pre><code class="lang-nginx"><span class="hljs-section">server</span> {
  <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl;
  <span class="hljs-attribute">server_name</span>  g.doman.cn;
  <span class="hljs-attribute">ssl_certificate</span> /etc/letsencrypt/live/*****/certificate.crt;
  <span class="hljs-attribute">ssl_certificate_key</span> /etc/letsencrypt/live/*****/private.key;
  <span class="hljs-comment"># .....</span>
}
</code></pre>
<p>&#x7F16;&#x8F91;<code>vi /usr/local/nginx/conf/nginx.conf</code>&#x4F60;&#x7684;nginx&#x914D;&#x7F6E;&#xFF0C;&#x5F15;&#x7528;&#x4F60;&#x590D;&#x5236;&#x8FC7;&#x6765;&#x7684;&#x914D;&#x7F6E;&#x3002;</p>
<pre><code class="lang-nginx"><span class="hljs-section">http</span> {
  <span class="hljs-comment"># .....</span>
  <span class="hljs-attribute">include</span> vhost/gitlab-http.conf;
}
</code></pre>
<p>&#x540C;&#x65F6;&#x8981;&#x628A;<code>/var/opt/gitlab/nginx/conf/nginx.conf</code>&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x53D8;&#x91CF;&#x590D;&#x5236;&#x5230;&#x81EA;&#x5DF1;&#x7684;nginx&#x914D;&#x7F6E;&#x4E2D;<code>nginx.conf</code></p>
<pre><code class="lang-nginx">http {
  # .....
  log_format gitlab_access &apos;$remote_addr - $remote_user [$time_local] &quot;$request_method $filtered_request_uri $server_protocol&quot; $status $body_bytes_sent &quot;$filtered_http_referer&quot; &quot;$http_user_agent&quot;&apos;;
  log_format gitlab_mattermost_access &apos;$remote_addr - $remote_user [$time_local] &quot;$request_method $filtered_request_uri $server_protocol&quot; $status $body_bytes_sent &quot;$filtered_http_referer&quot; &quot;$http_user_agent&quot;&apos;;

  proxy_cache_path proxy_cache keys_zone=gitlab:10m max_size=1g levels=1:2;
  proxy_cache gitlab;
  map $http_upgrade $connection_upgrade {
      default upgrade;
      &apos;&apos;      close;
  }

  # Remove private_token from the request URI
  # In:  /foo?private_token=unfiltered&amp;authenticity_token=unfiltered&amp;rss_token=unfiltered&amp;...
  # Out: /foo?private_token=[FILTERED]&amp;authenticity_token=unfiltered&amp;rss_token=unfiltered&amp;...
  map $request_uri $temp_request_uri_1 {
    default $request_uri;
    ~(?i)^(?&lt;start&gt;.*)(?&lt;temp&gt;[\?&amp;]private[\-_]token)=[^&amp;]*(?&lt;rest&gt;.*)$ &quot;$start$temp=[FILTERED]$rest&quot;;
  }
  # Remove authenticity_token from the request URI
  # In:  /foo?private_token=[FILTERED]&amp;authenticity_token=unfiltered&amp;rss_token=unfiltered&amp;...
  # Out: /foo?private_token=[FILTERED]&amp;authenticity_token=[FILTERED]&amp;rss_token=unfiltered&amp;...
  map $temp_request_uri_1 $temp_request_uri_2 {
    default $temp_request_uri_1;
    ~(?i)^(?&lt;start&gt;.*)(?&lt;temp&gt;[\?&amp;]authenticity[\-_]token)=[^&amp;]*(?&lt;rest&gt;.*)$ &quot;$start$temp=[FILTERED]$rest&quot;;
  }
  # Remove rss_token from the request URI
  # In:  /foo?private_token=[FILTERED]&amp;authenticity_token=[FILTERED]&amp;rss_token=unfiltered&amp;...
  # Out: /foo?private_token=[FILTERED]&amp;authenticity_token=[FILTERED]&amp;rss_token=[FILTERED]&amp;...
  map $temp_request_uri_2 $filtered_request_uri {
    default $temp_request_uri_2;
    ~(?i)^(?&lt;start&gt;.*)(?&lt;temp&gt;[\?&amp;]rss[\-_]token)=[^&amp;]*(?&lt;rest&gt;.*)$ &quot;$start$temp=[FILTERED]$rest&quot;;
  }
  # A version of the referer without the query string
  map $http_referer $filtered_http_referer {
    default $http_referer;
    ~^(?&lt;temp&gt;.*)\? $temp;
  }
}
</code></pre>
<h2 id="t22&#x66B4;&#x529B;&#x5347;&#x7EA7;">&#x66B4;&#x529B;&#x5347;&#x7EA7; <a href="#t22&#x66B4;&#x529B;&#x5347;&#x7EA7;"> # </a></h2>
<p>&#x76F4;&#x63A5;&#x7F16;&#x8F91;&#x6E90; /etc/yum.repos.d/gitlab-ce.repo&#xFF0C;&#x5B89;&#x88C5; GitLab &#x793E;&#x533A;&#x7248;</p>
<pre><code class="lang-bash">sudo yum install gitlab-ce <span class="hljs-comment">#(&#x81EA;&#x52A8;&#x5B89;&#x88C5;&#x6700;&#x65B0;&#x7248;)</span>
sudo yum install gitlab-ce-8.15.2-ce.0.el6 <span class="hljs-comment">#(&#x5B89;&#x88C5;&#x6307;&#x5B9A;&#x7248;&#x672C;)</span>
</code></pre>
<p>&#x5B89;&#x88C5;&#x8FC7;&#x7A0B;&#x4F1A;&#x62A5;&#x9519;</p>
<pre><code>gitlab preinstall: Automatically backing up only the GitLab SQL database (excluding everything else!)
Dumping database ...
Dumping PostgreSQL database gitlabhq_production ... pg_dump: [archiver (db)] connection to database &quot;gitlabhq_production&quot; failed: could not connect to server: &#x6CA1;&#x6709;&#x90A3;&#x4E2A;&#x6587;&#x4EF6;&#x6216;&#x76EE;&#x5F55;
    Is the server running locally and accepting
    connections on Unix domain socket &quot;/var/opt/gitlab/postgresql/.s.PGSQL.5432&quot;?
Backup failed
[FAILED]
gitlab preinstall:
gitlab preinstall: Backup failed! If you want to skip this backup, run the following command and
gitlab preinstall: try again:
gitlab preinstall:
gitlab preinstall:   sudo touch /etc/gitlab/skip-auto-migrations
gitlab preinstall:
error: %pre(gitlab-ce-8.15.2-ce.0.el6.x86_64) scriptlet failed, exit status 1
Error in PREIN scriptlet in rpm package gitlab-ce-8.15.2-ce.0.el6.x86_64
error:   install: %pre scriptlet failed (2), skipping gitlab-ce-8.15.2-ce.0.el6
gitlab-ce-8.11.5-ce.0.el6.x86_64 was supposed to be removed but is not!
  Verifying  : gitlab-ce-8.11.5-ce.0.el6.x86_64                                                                                                                                                             1/2
  Verifying  : gitlab-ce-8.15.2-ce.0.el6.x86_64                                                                                                                                                             2/2

Failed:
  gitlab-ce.x86_64 0:8.11.5-ce.0.el6
</code></pre><p>&#x770B;&#x4E0A;&#x9762;&#x4E00;&#x5806;&#x9519;&#x8BEF;&#xFF0C;&#x77AC;&#x95F4;&#x5C31;&#x61F5;&#x903C;&#x4E86;&#xFF0C;&#x770B;&#x5230;&#x4E00;&#x6761;&#x6551;&#x661F;&#x547D;&#x4EE4;&#x8BA9;&#x6211;&#x5C1D;&#x8BD5;&#x8FD0;&#x884C; <code>sudo touch /etc/gitlab/skip-auto-migrations</code> &#x4E8E;&#x662F;&#x6211;&#x4E8C;&#x903C;&#x7684;&#x91CD;&#x65B0;<code>yum install gitlab-ce</code>&#x8FD0;&#x884C;&#x4E86;&#xFF0C;&#x7ED3;&#x679C;&#x771F;&#x7684;&#x5B89;&#x88C5;&#x6210;&#x529F;&#x4E86;&#xFF0C;&#x1F604;&#x3002;</p>
<pre><code>...
gitlab: Thank you for installing GitLab!
gitlab: To configure and start GitLab, RUN THE FOLLOWING COMMAND:

sudo gitlab-ctl reconfigure

gitlab: GitLab should be reachable at http://114.55.148.71:8081
gitlab: Otherwise configure GitLab for your system by editing /etc/gitlab/gitlab.rb file
gitlab: And running reconfigure again.
gitlab:
gitlab: For a comprehensive list of configuration options please see the Omnibus GitLab readme
gitlab: https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/README.md
gitlab:

gitlab: GitLab now ships with a newer version of PostgreSQL (9.6.1), and will be used
gitlab: as the default in the next major relase. To upgrade, RUN THE FOLLOWING COMMANDS:

sudo gitlab-ctl pg-upgrade

gitlab: For more details, please see:
gitlab: https://docs.gitlab.com/omnibus/settings/database.html#upgrade-packaged-postgresql-server
gitlab:
  &#x6E05;&#x7406;       : gitlab-ce-8.11.5-ce.0.el6.x86_64                                                                                                                                                             2/2
Found /etc/gitlab/skip-auto-migrations, exiting...
  Verifying  : gitlab-ce-8.15.2-ce.0.el6.x86_64                                                                                                                                                             1/2
  Verifying  : gitlab-ce-8.11.5-ce.0.el6.x86_64                                                                                                                                                             2/2

&#x66F4;&#x65B0;&#x5B8C;&#x6BD5;:
  gitlab-ce.x86_64 0:8.15.2-ce.0.el6

&#x5B8C;&#x6BD5;&#xFF01;
</code></pre><p>&#x91CD;&#x542F;&#x914D;&#x7F6E;&#xFF0C;&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x5927;&#x90E8;&#x5206;<code>502</code>&#x9519;&#x8BEF;&#x3002;</p>
<pre><code class="lang-bash">gitlab-ctl reconfigure
</code></pre>
<h2 id="t23&#x9519;&#x8BEF;&#x5904;&#x7406;">&#x9519;&#x8BEF;&#x5904;&#x7406; <a href="#t23&#x9519;&#x8BEF;&#x5904;&#x7406;"> # </a></h2>
<h3 id="t24&#x89E3;&#x51B3;80&#x7AEF;&#x53E3;&#x88AB;&#x5360;&#x7528;">&#x89E3;&#x51B3;80&#x7AEF;&#x53E3;&#x88AB;&#x5360;&#x7528; <a href="#t24&#x89E3;&#x51B3;80&#x7AEF;&#x53E3;&#x88AB;&#x5360;&#x7528;"> # </a></h3>
<p>nginx&#x914D;&#x7F6E;&#x89E3;&#x51B3; <code>80</code> &#x7AEF;&#x53E3;&#x88AB;&#x5360;&#x7528;</p>
<pre><code class="lang-nginx"><span class="hljs-attribute">upstream</span> gitlab {
     <span class="hljs-attribute">server</span> <span class="hljs-number">114.55.111.111:8081</span> ;
}
<span class="hljs-section">server</span> {
  <span class="hljs-comment"># &#x4FA6;&#x542C;&#x7684;80&#x7AEF;&#x53E3;</span>
  <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;
  <span class="hljs-attribute">server_name</span>  git.diggg.cn;
  <span class="hljs-attribute">location</span> / {
    <span class="hljs-attribute">proxy_pass</span>   http://gitlab;    <span class="hljs-comment">#&#x5728;&#x8FD9;&#x91CC;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x4EE3;&#x7406;&#xFF0C;&#x548C;upstream&#x7684;&#x540D;&#x5B57;&#x4E00;&#x6837;</span>
    <span class="hljs-comment">#&#x4EE5;&#x4E0B;&#x662F;&#x4E00;&#x4E9B;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x7684;&#x914D;&#x7F6E;&#x53EF;&#x5220;&#x9664;</span>
    <span class="hljs-attribute">proxy_redirect</span>             <span class="hljs-literal">off</span>;
    <span class="hljs-comment">#&#x540E;&#x7AEF;&#x7684;Web&#x670D;&#x52A1;&#x5668;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;X-Forwarded-For&#x83B7;&#x53D6;&#x7528;&#x6237;&#x771F;&#x5B9E;IP</span>
    <span class="hljs-attribute">proxy_set_header</span>           Host <span class="hljs-variable">$host</span>;
    <span class="hljs-attribute">proxy_set_header</span>           X-Real-IP <span class="hljs-variable">$remote_addr</span>;
    <span class="hljs-attribute">proxy_set_header</span>           X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;
    <span class="hljs-attribute">client_max_body_size</span>       <span class="hljs-number">10m</span>; <span class="hljs-comment">#&#x5141;&#x8BB8;&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;&#x7684;&#x6700;&#x5927;&#x5355;&#x6587;&#x4EF6;&#x5B57;&#x8282;&#x6570;</span>
    <span class="hljs-attribute">client_body_buffer_size</span>    <span class="hljs-number">128k</span>; <span class="hljs-comment">#&#x7F13;&#x51B2;&#x533A;&#x4EE3;&#x7406;&#x7F13;&#x51B2;&#x7528;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;&#x7684;&#x6700;&#x5927;&#x5B57;&#x8282;&#x6570;</span>
    <span class="hljs-attribute">proxy_connect_timeout</span>      <span class="hljs-number">300</span>; <span class="hljs-comment">#nginx&#x8DDF;&#x540E;&#x7AEF;&#x670D;&#x52A1;&#x5668;&#x8FDE;&#x63A5;&#x8D85;&#x65F6;&#x65F6;&#x95F4;(&#x4EE3;&#x7406;&#x8FDE;&#x63A5;&#x8D85;&#x65F6;)</span>
    <span class="hljs-attribute">proxy_send_timeout</span>         <span class="hljs-number">300</span>; <span class="hljs-comment">#&#x540E;&#x7AEF;&#x670D;&#x52A1;&#x5668;&#x6570;&#x636E;&#x56DE;&#x4F20;&#x65F6;&#x95F4;(&#x4EE3;&#x7406;&#x53D1;&#x9001;&#x8D85;&#x65F6;)</span>
    <span class="hljs-attribute">proxy_read_timeout</span>         <span class="hljs-number">300</span>; <span class="hljs-comment">#&#x8FDE;&#x63A5;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x540E;&#x7AEF;&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x65F6;&#x95F4;(&#x4EE3;&#x7406;&#x63A5;&#x6536;&#x8D85;&#x65F6;)</span>
    <span class="hljs-attribute">proxy_buffer_size</span>          <span class="hljs-number">4k</span>; <span class="hljs-comment">#&#x8BBE;&#x7F6E;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#xFF08;nginx&#xFF09;&#x4FDD;&#x5B58;&#x7528;&#x6237;&#x5934;&#x4FE1;&#x606F;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x5927;&#x5C0F;</span>
    <span class="hljs-attribute">proxy_buffers</span>              <span class="hljs-number">4</span> <span class="hljs-number">32k</span>; <span class="hljs-comment">#proxy_buffers&#x7F13;&#x51B2;&#x533A;&#xFF0C;&#x7F51;&#x9875;&#x5E73;&#x5747;&#x5728;32k&#x4EE5;&#x4E0B;&#x7684;&#x8BDD;&#xFF0C;&#x8FD9;&#x6837;&#x8BBE;&#x7F6E;</span>
    <span class="hljs-attribute">proxy_busy_buffers_size</span>    <span class="hljs-number">64k</span>; <span class="hljs-comment">#&#x9AD8;&#x8D1F;&#x8377;&#x4E0B;&#x7F13;&#x51B2;&#x5927;&#x5C0F;&#xFF08;proxy_buffers*2&#xFF09;</span>
    <span class="hljs-attribute">proxy_temp_file_write_size</span> <span class="hljs-number">64k</span>; <span class="hljs-comment">#&#x8BBE;&#x5B9A;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#x5939;&#x5927;&#x5C0F;&#xFF0C;&#x5927;&#x4E8E;&#x8FD9;&#x4E2A;&#x503C;&#xFF0C;&#x5C06;&#x4ECE;upstream&#x670D;&#x52A1;&#x5668;&#x4F20;</span>
  }
}
</code></pre>
<p>nginx&#x914D;&#x7F6E;&#x68C0;&#x67E5;&#x548C;&#x7ACB;&#x5373;&#x751F;&#x6548;</p>
<pre><code class="lang-bash"><span class="hljs-comment"># &#x68C0;&#x67E5;&#x914D;&#x7F6E;</span>
/usr/<span class="hljs-built_in">local</span>/nginx/sbin/nginx -tc conf/nginx.conf
<span class="hljs-comment"># nginx &#x91CD;&#x65B0;&#x52A0;&#x8F7D;&#x914D;&#x7F6E;</span>
/usr/<span class="hljs-built_in">local</span>/nginx/sbin/nginx -s reload
</code></pre>
<h3 id="t25&#x5934;&#x50CF;&#x65E0;&#x6CD5;&#x6B63;&#x5E38;&#x663E;&#x793A;">&#x5934;&#x50CF;&#x65E0;&#x6CD5;&#x6B63;&#x5E38;&#x663E;&#x793A; <a href="#t25&#x5934;&#x50CF;&#x65E0;&#x6CD5;&#x6B63;&#x5E38;&#x663E;&#x793A;"> # </a></h3>
<p>&#x539F;&#x56E0;&#xFF1A;gravatar&#x88AB;&#x5899;
&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF1A;
&#x7F16;&#x8F91; /etc/gitlab/gitlab.rb&#xFF0C;&#x5C06;</p>
<pre><code class="lang-bash"><span class="hljs-comment"># gitlab_rails[&apos;gravatar_plain_url&apos;] = &apos;http://gravatar.duoshuo.com/avatar/%{hash}?s=%{size}&amp;d=identicon&apos;</span>
</code></pre>
<p>&#x4FEE;&#x6539;&#x4E3A;&#xFF1A;</p>
<pre><code>gitlab_rails[&apos;gravatar_plain_url&apos;] = &apos;http://gravatar.duoshuo.com/avatar/%{hash}?s=%{size}&amp;d=identicon&apos;
</code></pre><p>&#x7136;&#x540E;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x6267;&#x884C;&#xFF1A;</p>
<pre><code class="lang-bash">sudo gitlab-ctl reconfigure 
sudo gitlab-rake cache:clear RAILS_ENV=production
</code></pre>
<h3 id="t26internal API unreachable">internal API unreachable <a href="#t26internal API unreachable"> # </a></h3>
<p>&#x8FD9;&#x4E2A;&#x9519;&#x8BEF;&#x662F;&#x4E00;&#x4E2A;&#x81EA;&#x5DF1;&#x5236;&#x9020;&#x7684;&#x5751;&#xFF0C;&#x6211;&#x514B;&#x9686;&#x548C;&#x63D0;&#x4EA4;&#x90FD;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x641E;&#xFF0C;&#x4F46;&#x662F;&#x7F51;&#x7AD9;&#x80FD;&#x6B63;&#x5E38;&#x8FD0;&#x884C;&#xFF0C;&#x5C1D;&#x8BD5;&#x4E86;&#x975E;&#x5E38;&#x591A;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x6700;&#x7EC8;&#x6211;&#x7684;&#x95EE;&#x9898;&#x662F;<code>22</code>&#x7AEF;&#x53E3;&#x6CA1;&#x6709;&#x9690;&#x5C04;&#x51FA;&#x53BB;&#xFF0C;&#x597D;&#x5C34;&#x5C2C;&#x3002;</p>
<pre><code class="lang-bash">GitLab: Failed to authorize your Git request: internal API unreachable
</code></pre>
<p>&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF1A;<a href="https://gitlab.com/gitlab-org/gitlab-ce/issues/33702">https://gitlab.com/gitlab-org/gitlab-ce/issues/33702</a><br>&#x901A;&#x8FC7;&#x9632;&#x706B;&#x5899;&#x89C4;&#x5219; 127.0.0.1  </p>
<h3 id="t27proxy_temp &#x76EE;&#x5F55;&#x6CA1;&#x6709;&#x6743;&#x9650;">proxy_temp &#x76EE;&#x5F55;&#x6CA1;&#x6709;&#x6743;&#x9650; <a href="#t27proxy_temp &#x76EE;&#x5F55;&#x6CA1;&#x6709;&#x6743;&#x9650;"> # </a></h3>
<pre><code class="lang-bash">[crit] 14788<span class="hljs-comment">#0: *215 open() &quot;/usr/local/nginx/proxy_temp/5/01/0000000015&quot; failed (13: Permission denied) while reading upstream</span>
</code></pre>
<p>&#x4EE5;&#x4E0B;&#x65B9;&#x5F0F;&#x89E3;&#x51B3;</p>
<pre><code class="lang-bash">chown -R root:root /usr/<span class="hljs-built_in">local</span>/nginx/proxy_temp
<span class="hljs-comment"># &#x7F16;&#x8F91; nginx.conf</span>
sudo vi /usr/<span class="hljs-built_in">local</span>/nginx/conf/nginx.conf
<span class="hljs-comment"># &#x5728;&#x7B2C;&#x4E00;&#x884C;&#x6DFB;&#x52A0;</span>
user root;
</code></pre>
<h3 id="t28&#x5176;&#x5B83;&#x9519;&#x8BEF;">&#x5176;&#x5B83;&#x9519;&#x8BEF; <a href="#t28&#x5176;&#x5B83;&#x9519;&#x8BEF;"> # </a></h3>
<pre><code class="lang-bash">Error executing action `run` on resource <span class="hljs-string">&apos;bash[migrate gitlab-rails database]&apos;</span>
</code></pre>
<p>&#x4E0A;&#x9762;&#x9519;&#x8BEF;&#x662F;&#x6570;&#x636E;&#x5E93;&#x6CA1;&#x6709;&#x542F;&#x52A8;&#xFF0C;&#x6211;&#x4E0D;&#x77E5;&#x9053;&#x5982;&#x4F55;&#x542F;&#x52A8;&#xFF0C;&#x6211;&#x91CD;&#x542F;&#x4E86;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x597D;&#x7403;&#x4E86;&#x3002;&#x1F606; 
<a href="https://gitlab.com/gitlab-org/gitlab-ce/issues/2052#note_1667899">https://gitlab.com/gitlab-org/gitlab-ce/issues/2052#note_1667899</a></p>
<pre><code class="lang-bash">NameError: uninitialized constant Devise::Async
</code></pre>
<pre><code>Processing by RootController#index as HTML
Completed 401 Unauthorized in 17ms (ActiveRecord: 2.7ms)
</code></pre><pre><code>/var/log/gitlab/nginx/gitlab_access.log &lt;==
114.55.148.71 - - [04/Jan/2017:17:20:24 +0800] &quot;GET /favicon.ico HTTP/1.0&quot; 502 2662 &quot;http://git.xxxxx.cn/&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.95 Safari/537.36&quot;
</code></pre><h2 id="t29&#x53C2;&#x8003;&#x8D44;&#x6599;">&#x53C2;&#x8003;&#x8D44;&#x6599; <a href="#t29&#x53C2;&#x8003;&#x8D44;&#x6599;"> # </a></h2>
<ul>
<li><a href="https://packages.gitlab.com/gitlab/gitlab-ce">gitlab/gitlab-ce</a></li>
<li><a href="https://www.gitlab.cc/downloads">&#x5B98;&#x7F51;&#x4E0B;&#x8F7D;</a></li>
<li><a href="https://doc.gitlab.cc/ce/install/requirements.html">&#x5B98;&#x7F51;&#x5B89;&#x88C5;&#x8BF4;&#x660E;</a></li>
<li><a href="https://www.gitlab.cc/features/#enterprise">&#x5F00;&#x6E90;&#x7248;&#x672C;&#x548C;&#x4F01;&#x4E1A;&#x7248;&#x672C;&#x5BF9;&#x6BD4;</a></li>
<li><a href="https://gitlab.com/gitlab-org/gitlab-ce/blob/master/doc/update/8.14-to-8.15.md">&#x5B98;&#x65B9;&#x5347;&#x7EA7;Gitlab&#x6559;&#x7A0B;</a></li>
<li><a href="https://gitlab.com/gitlab-org/gitlab-recipes/tree/master/install/centos">&#x5B98;&#x65B9;Centos&#x5B89;&#x88C5;Gitlab&#x6559;&#x7A0B;</a></li>
<li><a href="http://opjasee.com/2016/01/28/gitlab-upgrade.html">Gitlab&#x5347;&#x7EA7;&#x8BB0;&#x5F55;</a></li>
<li><a href="http://www.yuzhewo.com/2015/11/03/%E4%BF%AE%E6%94%B9gitlab%E4%BD%BF%E7%94%A8%E7%8E%B0%E6%9C%89nginx%E6%9C%8D%E5%8A%A1%E5%8F%8A502%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/">&#x4FEE;&#x6539;gitlab&#x4F7F;&#x7528;&#x73B0;&#x6709;nginx&#x670D;&#x52A1;&#x53CA;502&#x95EE;&#x9898;&#x89E3;&#x51B3;</a></li>
<li><a href="http://blog.csdn.net/wangxicoding/article/details/43738137">&#x6211;&#x6240;&#x9047;&#x5230;&#x7684;GitLab 502&#x95EE;&#x9898;&#x7684;&#x89E3;&#x51B3;</a></li>
</ul>

        <div class="copyright">Powered by <a href="https://github.com/jaywcjlove/idoc" target="_blank">idoc</a>. Dependence <a href="https://nodejs.org">Node.js</a> run.</div>
    </div>
    
</div>


</body>
</html>
